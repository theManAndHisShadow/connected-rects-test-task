(()=>{"use strict";function t(t){return{carbon:"rgba(14, 14, 14, 1)",darkRed:"rgba(38, 12, 12, 1)",brightRed:"rgba(114, 6, 6, 1)",darkBlue:"rgba(12, 16, 38, 1)",brightBlue:"rgba(9, 12, 104, 1)",darkGreen:"rgba(12, 38, 12, 1)",brightGreen:"rgba(6, 114, 6, 1)"}[t]}function e(t,e){return e=Math.max(0,Math.min(e,1)),t.split(", ").map((function(t,n){return 3==n&&(t=e+")"),t})).join(", ")}function n(t,e,n){return void 0===n&&(n=0),t.x>=e.position.x-n&&t.x<=e.position.x+e.size.width+n&&t.y>=e.position.y-n&&t.y<=e.position.y+e.size.height+n}function i(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}var o=function(){function t(t,e){this.uniqueIDs=new Set,this.parent=t;var n=document.createElement("canvas");if(n.width=this.parent.width,n.height=this.parent.height,n.classList.add(e),this.body=n,this.context=n.getContext("2d"),!this.context)throw new Error("Failed to get 2D drawing context.");this.children=[]}return t.prototype.getUniqueID=function(){var t;do{t=Math.floor(1e4*Math.random())+1}while(this.uniqueIDs.has(t));return this.uniqueIDs.add(t),t},t.prototype.fill=function(t){this.context.fillStyle=t,this.context.fillRect(0,0,this.parent.width,this.parent.height)},t.prototype.appendChild=function(t){t.id=this.getUniqueID(),this.children.push(t)},t.prototype.render=function(){this.context.clearRect(0,0,this.parent.width,this.parent.height);for(var t=0,e=this.children;t<e.length;t++)e[t].renderAt(this.context)},t}(),r=function(){function t(t,e,n){this.width=e,this.height=n,this.background=new o(this,"app-canvas__background"),this.foreground=new o(this,"app-canvas__foreground");var i=document.createElement("div");i.classList.add("app-canvas__container"),i.appendChild(this.background.body),i.appendChild(this.foreground.body),i.style.width="".concat(e,"px"),i.style.height="".concat(n,"px"),document.querySelector(t).appendChild(i)}return t.prototype.addEventListener=function(t,e){this.foreground.body.addEventListener(t,(function(t){e(t)}))},t.prototype.processIntersectionsWithMouse=function(){var t=this;this.addEventListener("mousedown",(function(e){t.isMousePressed=!0})),this.addEventListener("mouseup",(function(e){t.isMousePressed=!1})),this.addEventListener("mousemove",(function(e){if(e instanceof MouseEvent)for(var n=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(t.foreground.body,e),i={x:0,y:0},o=0,r=t.foreground.children;o<r.length;o++){var s=r[o];if(n.x>=s.position.x&&n.x<=s.position.x+s.size.width&&n.y>=s.position.y&&n.y<=s.position.y+s.size.height){var h={target:s,mousePosition:n};s.dispatchEvent("mousemove",h),s.eventStates.mousemove=!0,s.eventStates.mouseover||(s.dispatchEvent("mouseover",h),s.eventStates.mouseover=!0,s.eventStates.mouseout=!1),t.isMousePressed&&(s.dispatchEvent("drag",{eventData:h,offset:{x:n.x-i.x,y:n.y-i.y}}),i=n,s.eventStates.drag=!0),!t.isMousePressed&&s.eventStates.drag&&(s.dispatchEvent("dragend",h),s.eventStates.drag=!1)}else s.eventStates.mouseout||(s.dispatchEvent("mouseout",{target:s}),s.eventStates.mouseout=!0,s.eventStates.mouseover=!1),s.eventStates.mousemove=!1}}))},t}();const s=r,h=function(){function t(){this.heap=[]}return t.prototype.enqueue=function(t,e){this.heap.push({item:t,priority:e}),this.bubbleUp()},t.prototype.dequeue=function(){if(!this.isEmpty()){var t=this.heap[0].item,e=this.heap.pop();return this.heap.length>0&&e&&(this.heap[0]=e,this.bubbleDown()),t}},t.prototype.bubbleUp=function(){for(var t=this.heap.length-1,e=this.heap[t];t>0;){var n=t-1>>>1,i=this.heap[n];if(e.priority>=i.priority)break;this.heap[t]=i,this.heap[n]=e,t=n}},t.prototype.bubbleDown=function(){for(var t=0,e=this.heap.length,n=this.heap[0];;){var i=2*t+1,o=2*t+2,r=-1;if(i<e&&this.heap[i].priority<n.priority&&(r=i),o<e&&this.heap[o].priority<(-1===r?n.priority:this.heap[r].priority)&&(r=o),-1===r)break;this.heap[t]=this.heap[r],this.heap[r]=n,t=r}},t.prototype.isEmpty=function(){return 0===this.heap.length},t}();var a=function(t,e,n){if(n||2===arguments.length)for(var i,o=0,r=e.length;o<r;o++)!i&&o in e||(i||(i=Array.prototype.slice.call(e,0,o)),i[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))},c=function(){function t(t,e){this.endPoints=[t,e],this.points=this.buildPathTrace()}return t.prototype.buildPathTrace=function(){var t=this.endPoints[0],e=this.endPoints[1],n=t.parent,i=e.parent;return this.findShortestPath(n,t,i,e)},t.prototype.findShortestPath=function(t,e,o,r){var s,c,p,u,d=new h,l=new Set,y=function(t,e,n){void 0===n&&(n=10);var i={x:t.x,y:t.y};switch(e){case"up":i.y-=n;break;case"down":i.y+=n;break;case"left":i.x-=n;break;case"right":i.x+=n;break;default:throw new Error("Invalid direction: direction must be 'up', 'down', 'left', or 'right'")}return i};for(d.enqueue({point:e.connectionPoint.point,direction:function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.abs(n)>Math.abs(i)?n>0?"right":"left":i>0?"down":"up"}(e.connectionPoint.point,r.connectionPoint.point),path:[e.connectionPoint.point],turns:0,length:0},0);!d.isEmpty();){var f=d.dequeue();if(Math.abs(f.point.x-r.connectionPoint.point.x)<=5&&Math.abs(f.point.y-r.connectionPoint.point.y)<=5)return f.path;l.add("".concat(f.point.x,",").concat(f.point.y));for(var g=0,v=["up","down","left","right"];g<v.length;g++){var b=v[g],x=y(f.point,b,5);if(!(l.has("".concat(x.x,",").concat(x.y))||n(x,t,t.style.maring)||n(x,o,o.style.maring))){var m=f.direction!==b,w=f.turns+(m?1:0),P=f.length+(c=x,void 0,void 0,p=(s=f.point).x-c.x,u=s.y-c.y,Math.sqrt(p*p+u*u)),k=a(a([],f.path,!0),[x],!1),S=P+5*w+i(x,r.connectionPoint.point);d.enqueue({point:x,direction:b,path:k,turns:w,length:P},S)}}}return[]},t.prototype.updatePath=function(){this.points=this.buildPathTrace()},t.prototype.renderSegmentsAt=function(t){var e=!0;t.lineWidth=1,t.strokeStyle="rgba(100, 100, 100, 1)";for(var n=0;n<this.points.length;n++){var i=this.points[n];e?(t.moveTo(i.x,i.y),e=!1):t.lineTo(i.x,i.y),t.stroke()}},t.prototype.renderAt=function(t){this.renderSegmentsAt(t)},t}();const p=c,u=function(){function t(t){this.connectionPoint={point:{x:t.x,y:t.y},angle:t.angle},this.letter=t.letter,this.parent=t.parent,this.r=t.r,this.isBusy=!1,this.endPoint=null,this.connection=null}return t.prototype.connectTo=function(t){this.endPoint=t,t.endPoint=this,this.isBusy=!0,t.isBusy=!0,this.connection=new p(this,this.endPoint),this.endPoint.connection=this.connection},t.prototype.reconnect=function(){this.connection=new p(this,this.endPoint),this.endPoint.connection=this.connection},t.prototype.renderAt=function(t){null!==this.connection&&this.connection.renderAt(t),t.beginPath(),t.arc(this.connectionPoint.point.x,this.connectionPoint.point.y,this.r,0,2*Math.PI,!1),t.fillStyle=this.isBusy?"rgba(125, 125, 125, 0.3)":this.parent.style.fillColor,t.strokeStyle=this.isBusy?"rgba(155, 155, 155, 0.4)":this.parent.style.borderColor,t.closePath(),t.fill(),t.stroke()},t}();var d,l=function(){function t(){this.events={}}return t.prototype.addEventListener=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},t.prototype.dispatchEvent=function(t,e){this.events[t]&&this.events[t].forEach((function(t){return t(e)}))},t}(),y=(d=function(t,e){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},d(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const f=function(t){function n(e){var n,i,o=t.call(this)||this;return e.id=null!==(n=e.id)&&void 0!==n?n:null,e.style.maring=null!==(i=e.style.maring)&&void 0!==i?i:10,Object.assign(o,e),o.id=null,o.eventStates={mouseout:!1,mouseover:!1,mouseup:!0,mousedown:!1,mousemove:!1,drag:!1},o}return y(n,t),n.prototype.updateOpacity=function(t){this.style.fillColor=e(this.style.fillColor,t),this.style.borderColor=e(this.style.borderColor,t)},n.prototype.isIntersectsWith=function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];if(this.id!==i.id&&this.position.x+this.size.width+2>=i.position.x&&this.position.x-2<=i.position.x+i.size.width&&this.position.y+this.size.height+2>=i.position.y&&this.position.y-2<=i.position.y+i.size.height)return!0}return!1},n.prototype.renderAt=function(t){},n}(l);var g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();const v=function(t){function e(e){var n=t.call(this,e)||this;return Object.assign(n,e),n.ports={A:new u({letter:"A",parent:n,angle:180,r:3,x:n.position.x-n.style.maring,y:n.position.y+n.size.height/2}),B:new u({letter:"B",parent:n,angle:90,r:3,x:n.position.x+n.size.width/2,y:n.position.y-n.style.maring}),C:new u({letter:"C",parent:n,angle:0,r:3,x:n.position.x+n.size.width+n.style.maring,y:n.position.y+n.size.height/2}),D:new u({letter:"D",parent:n,angle:270,r:3,x:n.position.x+n.size.width/2,y:n.position.y+n.size.height+n.style.maring})},n}return g(e,t),e.prototype.moveTo=function(t,e){var n=this.position.x-t,i=this.position.y-e;Object.values(this.ports).forEach((function(t){t.connectionPoint.point.x-=n,t.connectionPoint.point.y-=i,t.isBusy&&t.reconnect()})),this.position.x=t,this.position.y=e},e.prototype.renderAt=function(t){t.fillStyle=this.style.fillColor,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderThickness,t.fillRect(this.position.x,this.position.y,this.size.width,this.size.height),this.style.borderThickness>0&&t.strokeRect(this.position.x,this.position.y,this.size.width,this.size.height),Object.values(this.ports).forEach((function(e){e.renderAt(t)}))},e}(f);var b=new s("#app-root",500,500),x=new v({size:{width:100,height:80},position:{x:100,y:50},style:{fillColor:t("darkRed"),borderColor:t("brightRed"),borderThickness:2}}),m=new v({size:{width:100,height:80},position:{x:330,y:170},style:{fillColor:t("darkBlue"),borderColor:t("brightBlue"),borderThickness:2}});new v({size:{width:100,height:80},position:{x:190,y:270},style:{fillColor:t("darkGreen"),borderColor:t("brightGreen"),borderThickness:2}}),b.foreground.appendChild(x),b.foreground.appendChild(m),x.ports.B.connectTo(m.ports.A),b.background.fill(t("carbon")),function(t,e){var n=t.canvas,i=n.width,o=n.height;t.strokeStyle=e.gridLineColor,t.lineWidth=e.gridLineThickness,t.beginPath();for(var r=0;r<=i;r+=e.gridSize)t.moveTo(r,0),t.lineTo(r,o);for(var s=0;s<=o;s+=e.gridSize)t.moveTo(0,s),t.lineTo(i,s);t.stroke()}(b.background.context,{gridSize:20,gridLineColor:"rgba(255, 255, 255, 0.025)",gridLineThickness:1});var w=function(){requestAnimationFrame(w),b.foreground.render()};w(),b.foreground.children.forEach((function(t){t.addEventListener("mouseover",(function(e){t.updateOpacity(.35),b.foreground.body.style.cursor="pointer"})),t.addEventListener("mouseout",(function(e){t.updateOpacity(1),b.foreground.body.style.cursor="initial"})),t.addEventListener("drag",(function(e){t.updateOpacity(.1);var n={x:t.position.x,y:t.position.y};t.moveTo(e.offset.x-t.size.width/2,e.offset.y-t.size.height/2),t.isIntersectsWith(b.foreground.children)&&t.moveTo(n.x,n.y),b.foreground.body.style.cursor="grab"})),t.addEventListener("dragend",(function(e){t.updateOpacity(.35),b.foreground.body.style.cursor="pointer"}))})),b.processIntersectionsWithMouse(),console.log(b,x)})();