(()=>{"use strict";function t(t){return{carbon:"rgba(14, 14, 14, 1)",darkRed:"rgba(38, 12, 12, 1)",brightRed:"rgba(114, 6, 6, 1)",darkBlue:"rgba(12, 16, 38, 1)",brightBlue:"rgba(9, 12, 104, 1)",darkGreen:"rgba(12, 38, 12, 1)",brightGreen:"rgba(6, 114, 6, 1)"}[t]}function e(t,e){return e=Math.max(0,Math.min(e,1)),t.split(", ").map((function(t,n){return 3==n&&(t=e+")"),t})).join(", ")}function n(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function o(t,e,n){return void 0===n&&(n=0),t.x>=e.position.x-n&&t.x<=e.position.x+e.size.width+n&&t.y>=e.position.y-n&&t.y<=e.position.y+e.size.height+n}function i(t,e,n,o,i){return Math.pow(t-n,2)+Math.pow(e-o,2)<=Math.pow(i,2)}function r(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}const s=function(){function t(t,e){this.uniqueIDs=new Set,this.parent=t;var n=document.createElement("canvas");if(n.width=this.parent.width,n.height=this.parent.height,n.classList.add(e),this.body=n,this.context=n.getContext("2d"),!this.context)throw new Error("Failed to get 2D drawing context.");this.children=[]}return t.prototype.getUniqueID=function(){var t;do{t=Math.floor(1e4*Math.random())+1}while(this.uniqueIDs.has(t));return this.uniqueIDs.add(t),t},t.prototype.fill=function(t){this.context.fillStyle=t,this.context.fillRect(0,0,this.parent.width,this.parent.height)},t.prototype.appendChild=function(t){t.id=this.getUniqueID(),this.children.push(t)},t.prototype.render=function(){this.context.clearRect(0,0,this.parent.width,this.parent.height);for(var t=0,e=this.children;t<e.length;t++)e[t].renderAt(this.context)},t}(),a=function(){function t(t,e,n){this.width=e,this.height=n,this.background=new s(this,"app-canvas__background"),this.foreground=new s(this,"app-canvas__foreground");var o=document.createElement("div");o.classList.add("app-canvas__container"),o.appendChild(this.background.body),o.appendChild(this.foreground.body),o.style.width="".concat(e,"px"),o.style.height="".concat(n,"px"),document.querySelector(t).appendChild(o)}return t.prototype.addEventListener=function(t,e){this.foreground.body.addEventListener(t,(function(t){e(t)}))},t.prototype.processIntersectionsWithMouse=function(){var t=this;this.addEventListener("mousedown",(function(e){if(t.isMousePressed=!0,e instanceof MouseEvent)for(var o=n(t.foreground.body,e),r=0,s=t.foreground.children;r<s.length;r++)for(var a=s[r],h=0,c=Object.values(a.ports);h<c.length;h++){var p=c[h],u=p.connectionPoint.point;i(o.x,o.y,u.x,u.y,p.r)&&p.dispatchEvent("click",{target:p})}})),this.addEventListener("mouseup",(function(e){t.isMousePressed=!1})),this.addEventListener("mousemove",(function(e){if(e instanceof MouseEvent){for(var o=n(t.foreground.body,e),r={x:0,y:0},s=0,a=t.foreground.children;s<a.length;s++){var h=a[s];if(o.x>=h.position.x&&o.x<=h.position.x+h.size.width&&o.y>=h.position.y&&o.y<=h.position.y+h.size.height){var c={target:h,mousePosition:o};h.dispatchEvent("mousemove",c),h.eventStates.mousemove=!0,h.eventStates.mouseover||(h.dispatchEvent("mouseover",c),h.eventStates.mouseover=!0,h.eventStates.mouseout=!1),t.isMousePressed&&(h.dispatchEvent("drag",{eventData:c,offset:{x:o.x-r.x,y:o.y-r.y}}),r=o,h.eventStates.drag=!0),!t.isMousePressed&&h.eventStates.drag&&(h.dispatchEvent("dragend",c),h.eventStates.drag=!1)}else h.eventStates.mouseout||(h.dispatchEvent("mouseout",{target:h}),h.eventStates.mouseout=!0,h.eventStates.mouseover=!1),h.eventStates.mousemove=!1}for(var p=0,u=t.foreground.children;p<u.length;p++){h=u[p];for(var l=0,d=Object.values(h.ports);l<d.length;l++){var y=d[l],f=y.connectionPoint.point;i(o.x,o.y,f.x,f.y,y.hoverR)?y.eventStates.hoveron||(y.dispatchEvent("hoveron",{target:y}),y.eventStates.hoveron=!0,y.eventStates.hoveroff=!1):y.eventStates.hoveroff||(y.dispatchEvent("hoveroff",{target:y}),y.eventStates.hoveroff=!0,y.eventStates.hoveron=!1),i(o.x,o.y,f.x,f.y,2*y.r)?y.eventStates.mouseover||(y.dispatchEvent("mouseover",{target:y}),y.eventStates.mouseover=!0,y.eventStates.mouseout=!1):y.eventStates.mouseout||(y.dispatchEvent("mouseout",{target:y}),y.eventStates.mouseout=!0,y.eventStates.mouseover=!1)}}}}))},t}(),h=function(){function t(){this.heap=[]}return t.prototype.enqueue=function(t,e){this.heap.push({item:t,priority:e}),this.bubbleUp()},t.prototype.dequeue=function(){if(!this.isEmpty()){var t=this.heap[0].item,e=this.heap.pop();return this.heap.length>0&&e&&(this.heap[0]=e,this.bubbleDown()),t}},t.prototype.bubbleUp=function(){for(var t=this.heap.length-1,e=this.heap[t];t>0;){var n=t-1>>>1,o=this.heap[n];if(e.priority>=o.priority)break;this.heap[t]=o,this.heap[n]=e,t=n}},t.prototype.bubbleDown=function(){for(var t=0,e=this.heap.length,n=this.heap[0];;){var o=2*t+1,i=2*t+2,r=-1;if(o<e&&this.heap[o].priority<n.priority&&(r=o),i<e&&this.heap[i].priority<(-1===r?n.priority:this.heap[r].priority)&&(r=i),-1===r)break;this.heap[t]=this.heap[r],this.heap[r]=n,t=r}},t.prototype.isEmpty=function(){return 0===this.heap.length},t}();var c=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))};const p=function(){function t(t){var e=t.parent,n=t.gridLineColor,o=t.gridPointColor,i=t.gridLineThickness;this.parent=e,this.points=this.generate(),this.gridLineColor=n,this.gridLineThickness=i,this.gridPointColor=o}return t.prototype.generate=function(){var t,e=function(t,e){var n=e.x,o=e.y,i=t.size,r=i.width,s=i.height,a=r/2,h=s/2,c=t.style.margin;return{centerPoint:{x:n+a,y:o+h},topCenterPoint:{x:n+a,y:o-c},leftCenterPoint:{x:n-c,y:o+h},bottomCenterPoint:{x:n+a,y:o+s+c},rightCenterPoint:{x:n+r+c,y:o+h},leftTopPoint:{x:n-c,y:o-c},leftBottomPoint:{x:n-c,y:o+s+c},rightTopPoint:{x:n+r+c,y:o-c},rightBottomPoint:{x:n+r+c,y:o+s+c}}},n=function(t,e){return e.map((function(e){return{x:e,y:t}}))},o=[],i=this.parent.endPoints[0],r=this.parent.endPoints[1],s=e(i.parent,i.parent.position),a=e(i.parent,{x:i.parent.position.x,y:r.parent.position.y}),h=e(r.parent,r.parent.position),p=e(r.parent,{x:r.parent.position.x,y:i.parent.position.y}),u=s.centerPoint,l=h.centerPoint,d=(u.x+l.x)/2,y=(u.y+l.y)/2,f=c(c(c([],(t=d,[s.leftTopPoint.y,s.centerPoint.y,s.leftBottomPoint.y,y,a.leftTopPoint.y,a.centerPoint.y,a.leftBottomPoint.y].map((function(e){return{x:t,y:e}}))),!0),n(y,[s.leftTopPoint.x,s.centerPoint.x,s.rightBottomPoint.x]),!0),n(y,[h.leftTopPoint.x,h.centerPoint.x,h.rightBottomPoint.x]),!0);return o.push.apply(o,Object.values(s)),o.push.apply(o,Object.values(a)),o.push.apply(o,Object.values(h)),o.push.apply(o,Object.values(p)),o.push.apply(o,f),o},t.prototype.update=function(){this.points=this.generate()},t.prototype.renderAt=function(t){if(!(this.points.length<2)){t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=1;var e=function(t,e){var n=new Map;return t.forEach((function(t){var o=t[e];n.has(o)||n.set(o,[]),n.get(o).push(t)})),n};e(this.points,"y").forEach((function(e){t.beginPath(),e.sort((function(t,e){return t.x-e.x}));for(var n=0;n<e.length-1;n++)t.moveTo(e[n].x,e[n].y),t.lineTo(e[n+1].x,e[n+1].y);t.stroke(),t.closePath()})),e(this.points,"x").forEach((function(e){t.beginPath(),e.sort((function(t,e){return t.y-e.y}));for(var n=0;n<e.length-1;n++)t.moveTo(e[n].x,e[n].y),t.lineTo(e[n+1].x,e[n+1].y);t.stroke(),t.closePath()})),this.points.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI,!1),t.fillStyle="magenta",t.fill(),t.closePath()}))}},t}();var u=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},l=function(){function t(t,e){this.endPoints=[t,e],this.points=this.buildPathTrace(),this.grid=new p({parent:this,gridLineColor:"rgba(255, 255, 255, 0.1)",gridPointColor:"magenta",gridLineThickness:1})}return t.prototype.buildPathTrace=function(){var t=this.endPoints[0],e=this.endPoints[1],n=t.parent,o=e.parent;return this.findShortestPath(n,t,o,e)},t.prototype.findShortestPath=function(t,e,n,i){var s,a,c,p,l=function(t,e,n){void 0===n&&(n=10);var o={x:t.x,y:t.y};switch(e){case"up":o.y-=n;break;case"down":o.y+=n;break;case"left":o.x-=n;break;case"right":o.x+=n;break;default:throw new Error("Invalid direction: direction must be 'up', 'down', 'left', or 'right'")}return o},d=new h,y=new Set;for(d.enqueue({point:e.connectionPoint.point,direction:function(t,e){var n=e.x-t.x,o=e.y-t.y;return Math.abs(n)>Math.abs(o)?n>0?"right":"left":o>0?"down":"up"}(e.connectionPoint.point,i.connectionPoint.point),path:[e.connectionPoint.point],turns:0,length:0},0);!d.isEmpty();){var f=d.dequeue();if(Math.abs(f.point.x-i.connectionPoint.point.x)<=5&&Math.abs(f.point.y-i.connectionPoint.point.y)<=5)return f.path;y.add("".concat(f.point.x,",").concat(f.point.y));for(var v=0,g=["up","down","left","right"];v<g.length;v++){var b=g[v],x=l(f.point,b,5);if(!(y.has("".concat(x.x,",").concat(x.y))||o(x,t,t.style.margin)||o(x,n,n.style.margin))){var m=f.direction!==b,P=f.turns+(m?1:0),w=f.length+(a=x,void 0,void 0,c=(s=f.point).x-a.x,p=s.y-a.y,Math.sqrt(c*c+p*p)),E=u(u([],f.path,!0),[x],!1),S=w+5*P+r(x,i.connectionPoint.point);d.enqueue({point:x,direction:b,path:E,turns:P,length:w},S)}}}return[]},t.prototype.updatePath=function(){this.points=this.buildPathTrace(),this.grid.update()},t.prototype.renderSegmentsAt=function(t){var e=!0;t.beginPath(),t.lineWidth=1,t.strokeStyle="rgba(100, 100, 100, 1)";for(var n=0;n<this.points.length;n++){var o=this.points[n];e?(t.moveTo(o.x,o.y),e=!1):t.lineTo(o.x,o.y),t.stroke()}t.closePath()},t.prototype.renderAt=function(t){this.renderSegmentsAt(t),this.grid.renderAt(t)},t}();const d=l,y=function(){function t(){this.events={},this.eventStates={mouseout:!1,mouseover:!1,mouseup:!0,mousedown:!1,mousemove:!1,hoveron:!1,hoveroff:!1,drag:!1}}return t.prototype.addEventListener=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},t.prototype.dispatchEvent=function(t,e){this.events[t]&&this.events[t].forEach((function(t){return t(e)}))},t}();var f,v=(f=function(t,e){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},f(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const g=function(t){function e(e){var n=t.call(this)||this;return n.connectionPoint={point:{x:e.x,y:e.y},angle:e.angle},n.letter=e.letter,n.parent=e.parent,n.r=e.r,n.hoverR=10*n.r,n.isBusy=!1,n.endPoint=null,n.connection=null,n.style={visibility:!1,fillColor:"rgba(255, 255, 255, 0.2",borderColor:"rgba(255, 255, 255, 0.2",borderThickness:0},n}return v(e,t),e.prototype.connectTo=function(t){this.endPoint=t,t.endPoint=this,this.isBusy=!0,t.isBusy=!0,this.connection=new d(this,this.endPoint),this.endPoint.connection=this.connection},e.prototype.reconnect=function(){this.connection=new d(this,this.endPoint),this.endPoint.connection=this.connection},e.prototype.renderAt=function(t){null!==this.connection&&this.connection.renderAt(t),this.style.visibility&&(t.beginPath(),t.arc(this.connectionPoint.point.x,this.connectionPoint.point.y,this.r,0,2*Math.PI,!1),t.fillStyle=this.isBusy?"rgba(125, 125, 125, 0.3)":this.parent.style.fillColor,t.strokeStyle=this.isBusy?"rgba(155, 155, 155, 0.4)":this.parent.style.borderColor,t.fill(),t.stroke(),t.closePath())},e}(y);var b=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const x=function(t){function n(e){var n,o,i=t.call(this)||this;return e.id=null!==(n=e.id)&&void 0!==n?n:null,e.style.margin=null!==(o=e.style.margin)&&void 0!==o?o:10,Object.assign(i,e),i.id=null,i}return b(n,t),n.prototype.updateOpacity=function(t){this.style.fillColor=e(this.style.fillColor,t),this.style.borderColor=e(this.style.borderColor,t)},n.prototype.isIntersectsWith=function(t){for(var e=0,n=t;e<n.length;e++){var o=n[e];if(this.id!==o.id&&this.position.x+this.size.width+2>=o.position.x&&this.position.x-2<=o.position.x+o.size.width&&this.position.y+this.size.height+2>=o.position.y&&this.position.y-2<=o.position.y+o.size.height)return!0}return!1},n.prototype.renderAt=function(t){},n}(y);var m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const P=function(t){function e(e){var n=t.call(this,e)||this;return Object.assign(n,e),n.ports={A:new g({letter:"A",parent:n,angle:180,r:3,x:n.position.x-n.style.margin,y:n.position.y+n.size.height/2}),B:new g({letter:"B",parent:n,angle:90,r:3,x:n.position.x+n.size.width/2,y:n.position.y-n.style.margin}),C:new g({letter:"C",parent:n,angle:0,r:3,x:n.position.x+n.size.width+n.style.margin,y:n.position.y+n.size.height/2}),D:new g({letter:"D",parent:n,angle:270,r:3,x:n.position.x+n.size.width/2,y:n.position.y+n.size.height+n.style.margin})},n}return m(e,t),e.prototype.moveTo=function(t,e){var n=this.position.x-t,o=this.position.y-e;Object.values(this.ports).forEach((function(t){t.connectionPoint.point.x-=n,t.connectionPoint.point.y-=o,t.isBusy&&t.reconnect()})),this.position.x=t,this.position.y=e},e.prototype.renderAt=function(t){t.fillStyle=this.style.fillColor,t.strokeStyle=this.style.borderColor,t.lineWidth=this.style.borderThickness,t.fillRect(this.position.x,this.position.y,this.size.width,this.size.height),this.style.borderThickness>0&&t.strokeRect(this.position.x,this.position.y,this.size.width,this.size.height),Object.values(this.ports).forEach((function(e){e.renderAt(t)}))},e}(x);var w=new a("#app-root",500,500),E=new P({size:{width:100,height:80},position:{x:100,y:50},style:{fillColor:t("darkRed"),borderColor:t("brightRed"),borderThickness:2}}),S=new P({size:{width:100,height:80},position:{x:330,y:170},style:{fillColor:t("darkBlue"),borderColor:t("brightBlue"),borderThickness:2}});w.foreground.appendChild(E),w.foreground.appendChild(S),E.ports.D.connectTo(S.ports.B),w.background.fill(t("carbon")),function(t,e){var n=t.canvas,o=n.width,i=n.height;t.strokeStyle=e.gridLineColor,t.lineWidth=e.gridLineThickness,t.beginPath();for(var r=0;r<=o;r+=e.gridSize)t.moveTo(r,0),t.lineTo(r,i);for(var s=0;s<=i;s+=e.gridSize)t.moveTo(0,s),t.lineTo(o,s);t.stroke()}(w.background.context,{gridSize:20,gridLineColor:"rgba(255, 255, 255, 0.025)",gridLineThickness:1});var k=function(){requestAnimationFrame(k),w.foreground.render()};k(),w.foreground.children.forEach((function(t){t.addEventListener("mouseover",(function(e){t.updateOpacity(.35),w.foreground.body.style.cursor="pointer"})),t.addEventListener("mouseout",(function(e){t.updateOpacity(1),w.foreground.body.style.cursor="initial"})),t.addEventListener("drag",(function(e){t.updateOpacity(.1);var n={x:t.position.x,y:t.position.y};t.moveTo(e.offset.x-t.size.width/2,e.offset.y-t.size.height/2),t.isIntersectsWith(w.foreground.children)&&t.moveTo(n.x,n.y),w.foreground.body.style.cursor="grab"})),t.addEventListener("dragend",(function(e){t.updateOpacity(.35),w.foreground.body.style.cursor="pointer"})),Object.values(t.ports).forEach((function(t){t.addEventListener("mouseover",(function(){w.foreground.body.style.cursor="pointer",t.style.visibility=!0})),t.addEventListener("hoveron",(function(){t.style.visibility=!0})),t.addEventListener("hoveroff",(function(){t.style.visibility=!1})),t.addEventListener("mouseout",(function(){w.foreground.body.style.cursor="initial"})),t.addEventListener("click",(function(){console.log("current selected port:",t)}))}))})),w.processIntersectionsWithMouse(),console.log(w,E)})();